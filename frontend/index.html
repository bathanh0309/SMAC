<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Person Detection Gate Control</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>üö™ Person Detection Gate System</h1>

    <div class="container">
        <!-- Camera Stream -->
        <div class="camera-section">
            <h2>üì∑ AI Person Detection</h2>
            <img id="stream" src="http://localhost:8000/video_feed" alt="AI Webcam Stream">
            <div class="camera-status">
                <span id="camera-status-text">üü¢ AI Camera: Active</span>
                <span id="detection-status-text">‚ö™ Ch·ªù ph√°t hi·ªán...</span>
            </div>
        </div>

        <!-- Live Detection Logs -->
        <div class="csv-section">
            <h2>üìä Detection Logs</h2>

            <div class="button-group">
                <button class="btn-export-csv" onclick="exportLogsToCSV()">
                    üì• Export CSV
                </button>
                <button class="btn-refresh" onclick="fetchLogs(); fetchDetections();">
                    üîÑ Refresh
                </button>
            </div>

            <div class="table-container">
                <table id="log-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Event</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" class="table-loading">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Gate Control -->
        <div class="reserved-top">
            <h2>üöß Gate Control</h2>

            <div class="gate-control-grid">
                <!-- Gate Visual + Button -->
                <div class="gate-visual-column">
                    <div class="gate-wrapper-new">
                        <!-- Light Bulb Indicator -->
                        <div class="light-bulb-container">
                            <div class="light-bulb" id="light-bulb">üí°</div>
                            <span id="countdown-text"></span>
                        </div>

                        <!-- Gate Visual Area -->
                        <div class="gate-visual-area">
                            <div class="gate-label-new in">IN</div>

                            <div class="gate-visual-new">
                                <div class="center-pole-new"></div>
                                <div class="barrier-new in" id="barrier-in"></div>
                            </div>
                        </div>

                        <!-- Single Gate Button -->
                        <div class="gate-buttons-area">
                            <button class="gate-btn-vertical" id="btn-in" onclick="toggleGateIN()">
                                <span id="btn-in-text">GATE IN</span>
                                <small id="btn-in-state">CLOSE</small>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Detections -->
                <div class="vehicles-column">
                    <div class="vehicles-parking-section">
                        <h3 class="realtime-heading">üë§ Recent Detections</h3>
                        <div class="table-container realtime-table-container">
                            <table id="detections-table">
                                <thead>
                                    <tr>
                                        <th>Person</th>
                                        <th>Time</th>
                                        <th>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="3" class="table-empty">No detections</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="scripts.js"></script>
</body>

</html>