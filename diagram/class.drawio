<mxfile host="65bd71144e">
    <diagram name="Class Diagram - SMAC" id="class-diagram">
        <mxGraphModel dx="1020" dy="624" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" background="#FFFFFF" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="SMAC - Class Diagram" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#1a73e8;" parent="1" vertex="1">
                    <mxGeometry x="600" y="20" width="400" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="class1" value="&lt;b&gt;PersonDetectionSystem&lt;/b&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="290" y="98" width="268" height="381" as="geometry"/>
                </mxCell>
                <mxCell id="class1-attr" value="- MODEL_PATH: str&#xa;- CONFIDENCE_THRESHOLD: float = 0.7&#xa;- PERSON_CLASS_ID: int = 0&#xa;- SAVE_DIR: str&#xa;- model: YOLO&#xa;- frame: numpy.ndarray&#xa;- frame_lock: threading.Lock&#xa;- running: bool&#xa;- gate: GateController&#xa;- app: Flask&#xa;- current_person_detected: bool&#xa;- current_person_count: int&#xa;- current_confidence: float" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class1" vertex="1">
                    <mxGeometry y="30" width="268" height="193" as="geometry"/>
                </mxCell>
                <mxCell id="class1-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#6c8ebf;" parent="class1" vertex="1">
                    <mxGeometry y="223" width="268" height="8" as="geometry"/>
                </mxCell>
                <mxCell id="class1-methods" value="+ __init__()&#xa;+ _find_model(): str&#xa;+ _setup_routes()&#xa;+ _generate_frames(): Generator&#xa;+ _get_countdown_display(): float&#xa;+ process_frame(frame): tuple&#xa;+ save_detection(frame, count, conf): str&#xa;+ send_telegram_alert(path, count, conf): bool&#xa;+ run_flask()&#xa;+ run(show_window, camera_index)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class1" vertex="1">
                    <mxGeometry y="231" width="268" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="class2" value="&lt;b&gt;GateController&lt;/b&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="600" y="100" width="213" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="class2-attr" value="+ STATE_CLOSED: str = &quot;CLOSED&quot;&#xa;+ STATE_OPEN: str = &quot;OPEN&quot;&#xa;+ OPEN_DELAY: float = 10.0&#xa;+ CLOSE_DELAY: float = 0.5&#xa;- state: str&#xa;- person_present_start: float&#xa;- person_absent_start: float" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class2" vertex="1">
                    <mxGeometry y="30" width="213" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="class2-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#82b366;" parent="class2" vertex="1">
                    <mxGeometry y="140" width="213" height="8" as="geometry"/>
                </mxCell>
                <mxCell id="class2-methods" value="+ __init__()&#xa;+ update(person_detected: bool): str&#xa;+ _open_gate(): bool&#xa;+ _close_gate(): bool&#xa;+ force_open(): bool&#xa;+ force_close(): bool&#xa;+ get_status(): dict&#xa;+ cleanup()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class2" vertex="1">
                    <mxGeometry y="148" width="213" height="132" as="geometry"/>
                </mxCell>
                <mxCell id="class3" value="&lt;b&gt;DetectionDatabase&lt;/b&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="597" y="401" width="215" height="240" as="geometry"/>
                </mxCell>
                <mxCell id="class3-attr" value="- db_path: str&#xa;- conn: sqlite3.Connection" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class3" vertex="1">
                    <mxGeometry y="30" width="215" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="class3-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#d6b656;" parent="class3" vertex="1">
                    <mxGeometry y="80" width="215" height="8" as="geometry"/>
                </mxCell>
                <mxCell id="class3-methods" value="+ __init__(db_path: str = None)&#xa;+ create_database()&#xa;+ add_detection(count, conf, path): int&#xa;+ get_all_detections(): list&#xa;+ get_recent_detections(limit): list&#xa;+ get_stats(): dict&#xa;+ clear_all()&#xa;+ close()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class3" vertex="1">
                    <mxGeometry y="88" width="215" height="152" as="geometry"/>
                </mxCell>
                <mxCell id="class4" value="&lt;b&gt;TelegramBot&lt;/b&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="877" y="107" width="260" height="208" as="geometry"/>
                </mxCell>
                <mxCell id="class4-attr" value="- token: str&#xa;- chat_id: str&#xa;- base_url: str&#xa;- is_configured: bool" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class4" vertex="1">
                    <mxGeometry y="30" width="260" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="class4-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#b85450;" parent="class4" vertex="1">
                    <mxGeometry y="100" width="260" height="8" as="geometry"/>
                </mxCell>
                <mxCell id="class4-methods" value="+ __init__(token, chat_id)&#xa;+ _check_configured(): bool&#xa;+ get_chat_id_from_updates(): str&#xa;+ send_message(msg, chat_id): bool&#xa;+ send_photo(path, caption, chat_id): bool&#xa;+ send_detection_alert(path, num, conf): bool" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="class4" vertex="1">
                    <mxGeometry y="108" width="260" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="ext1" value="&lt;b&gt;YOLO&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="290" y="497" width="69" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="ext2" value="&lt;b&gt;Flask&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="387.5" y="498" width="73" height="43" as="geometry"/>
                </mxCell>
                <mxCell id="ext3" value="&lt;b&gt;OpenCV&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="490" y="495" width="68" height="46" as="geometry"/>
                </mxCell>
                <mxCell id="ext4" value="&lt;b&gt;SQLite3&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="880" y="417" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ext5" value="&lt;b&gt;Requests&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="877" y="336" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rel1" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.997;exitY=0.292;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="class1-attr" target="class2-attr" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel1-label" value="uses" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontStyle=2;" parent="1" vertex="1">
                    <mxGeometry x="553" y="158" width="50" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="rel2" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.509;exitY=0.998;exitDx=0;exitDy=0;entryX=0.518;entryY=0.001;entryDx=0;entryDy=0;exitPerimeter=0;entryPerimeter=0;" parent="1" source="class2-methods" target="class3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel3" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="class3-attr" target="class4-attr" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel4" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="class1" target="ext1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel5" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="class1" target="ext2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel6" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="class1" target="ext3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel7" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="class3-attr" target="ext4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rel8" value="" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.227;exitY=0.997;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="class4-methods" target="ext5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="legend" value="Legend" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="880" y="490" width="200" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="legend1" value="─ ─ ─►  Dependency (uses)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="legend" vertex="1">
                    <mxGeometry y="26" width="200" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="legend2" value="■ Core Classes" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="legend" vertex="1">
                    <mxGeometry y="52" width="200" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="legend3" value="■ External Libraries" style="text;strokeColor=none;fillColor=#e1d5e7;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;strokeColor=#9673a6;" parent="legend" vertex="1">
                    <mxGeometry y="78" width="200" height="32" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>